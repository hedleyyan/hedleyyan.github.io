<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Utf-8 | Hedley]]></title>
  <link href="http://hedleyyan.github.io/blog/categories/utf-8/atom.xml" rel="self"/>
  <link href="http://hedleyyan.github.io/"/>
  <updated>2015-09-08T16:32:05+08:00</updated>
  <id>http://hedleyyan.github.io/</id>
  <author>
    <name><![CDATA[hedley]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[MySQL5.5 ä»¥ä¸‹ç‰ˆæœ¬é€šè¿‡ Java è½¬ä¹‰å®ç° Emoji å­˜å–]]></title>
    <link href="http://hedleyyan.github.io/blog/2015/08/05/mysql5-dot-5-yi-xia-ban-ben-tong-guo-java-zhuan-yi-shi-xian-emoji-cun-qu/"/>
    <updated>2015-08-05T22:41:19+08:00</updated>
    <id>http://hedleyyan.github.io/blog/2015/08/05/mysql5-dot-5-yi-xia-ban-ben-tong-guo-java-zhuan-yi-shi-xian-emoji-cun-qu</id>
    <content type="html"><![CDATA[<p>æˆ‘ä¸è¾“å‡ºå¥½æ–‡ï¼Œæˆ‘åªæ˜¯å¥½æ–‡çš„æ¬è¿å·¥ã€‚<a href="http://cenalulu.github.io/linux/character-encoding">ååˆ†é’Ÿææ¸…å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç </a>å¸¦ä½ èµ°è¿› <em>Unicode</em> å’Œ <em>UTF-8</em> çš„å‰ä¸–ä»Šç”Ÿã€‚æ€»è€Œè¨€ä¹‹ï¼Œ<em>Unicode</em> æ˜¯æ ‡å‡†ï¼Œ<em>UTF-8</em> æ˜¯å®ç°ã€‚</p>

<h2>MySQL è¿‡æ‹› <em>Emoji</em></h2>

<p>é€šå¸¸ MySQL çš„é»˜è®¤å­—ç¬¦é›†éƒ½ä¼šé…ç½®ä¸º <em>UTF-8</em>ï¼Œåªæ”¯æŒå•å­—ç¬¦ä¸è¶…è¿‡ 3 bytes çš„å­˜å‚¨<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>ã€‚å¸¸è§çš„ <em><a href="https://en.wikipedia.org/wiki/Emoji">Emoji</a></em> çš„ <em>Unicode</em> ç¼–ç å€¼ <em>code point</em> ä½äº <code>\u1F601 -- \u1F64F</code> åŒºé—´ï¼Œä»¥ <code>\u1F300</code> ã€ğŸŒ€ã€ä¸¾ä¾‹ï¼Œå®ƒçš„äºŒè¿›åˆ¶æœ‰ 17 ä½ï¼Œæ— æ³•ç”¨ä¸‰å­—èŠ‚çš„ <em>UTF-8</em> ç¼–ç è¡¨ç¤º<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>ã€‚å¦‚æœé€šè¿‡ JDBC å°†æ­¤å­—ç¬¦å°è¯•æ’å…¥ MySQL è®°å½•ä¸­ï¼Œä¼šå¾—åˆ°ä»¥ä¸‹å¼‚å¸¸</p>

<pre><code>java.lang.RuntimeException: java.sql.SQLException: Incorrect string value: '\xF0\x9F\x8C\x80' for column 'message' at row 1 
</code></pre>

<h2>Java è¿‡æ‹› <em>Emoji</em></h2>

<p>Java å­˜å‚¨å­—ç¬¦çš„å•å…ƒæ˜¯ <code>char</code>ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ16 ä½çš„ <code>char</code> å¦‚ä½• handle 17 ä½çš„ <em>Unicode</em> å‘¢ï¼Ÿ</p>

<p><img src="/images/doughnut.png"></p>

<p>å–œé—»ä¹è§ï¼ŒJava çš„å•ä¸ª <code>char</code> ç¡®å®æ— æ³• handle ğŸŒ€ã€‚é‚£ä¹ˆ âš¡ ä¸ºä»€ä¹ˆå¯ä»¥é€šè¿‡ç¼–è¯‘ï¼Ÿç›¸ä¿¡èªæ˜å¦‚ä½ ï¼Œä¸€å®šå¯ä»¥æŸ¥åˆ° âš¡ çš„ <em>Unicode</em> æ˜¯ <code>\u26A1</code>ï¼ŒTada ~~ æ‰€ä»¥ âš¡ æ’å…¥æ•°æ®åº“ä¸­ä¹Ÿæ˜¯å¦¥å¦¥çš„ã€‚</p>

<p>é€Ÿå…¥ <a href="http://www.czyborra.com/utf/#Java">Java&rsquo;s Unicode Notation</a> ç§‘æ™®ä¸€ä¸‹ Java å¯¹ <em>Unicode</em> çš„æ”¯æŒå®ç°ï¼Œé…åˆ<a href="http://chenbochiuan.vip.blog.163.com/blog/static/172332969201072784730795/">é€šä¿—æ˜“æ‡‚ç‰ˆ</a>æ›´èµ<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>ã€‚åŸæ¥ Java å­˜å‚¨å•ä¸ªå­—ç¬¦çš„æœ€å°å•å…ƒå¹¶ä¸ä¸€å®šæ˜¯å•ä¸ª <code>char</code>ï¼Œè€Œæ˜¯æ ¹æ® <em>code point</em> çš„èŒƒå›´ç¡®å®šã€‚å¦‚æœå­—ç¬¦ <code>c</code> çš„ <em>code point</em> äºŒè¿›åˆ¶è¡¨ç¤ºä¸è¶…è¿‡ 16 ä½é‚£ä¹ˆå•ä¸ª <code>char</code> å¯ç›´æ¥è¡¨ç¤º<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup>ï¼›å¦åˆ™è¦è¿›è¡Œä»¥ä¸‹å¤„ç†ï¼Œä»¥ ğŸŒ€ ä¸¾ä¾‹</p>

<ul>
<li>æŠŠ <code>\u1F300</code> çš„äºŒè¿›åˆ¶è¡¨ç¤º <code>0001 11110011 00000000</code>ï¼Œå…¶é«˜ 10 ä½ä¸ä½ 10 ä½æ‹†å¼€å¤‡ç”¨</li>
<li>é«˜ä½åç§»é‡ W1 : <code>0xD7C0</code> ä¸ä½ä½åç§»é‡ W2 : <code>0xDC00</code> åˆ†åˆ«ä¸å…¶é«˜ä½ 10 ä½ç›¸åŠ å¤„ç†ï¼Œå¾—åˆ° <code>\uD83C</code> ä¸ <code>\uDF00</code><sup id="fnref:5"><a href="#fn:5" rel="footnote">5</a></sup></li>
<li>ä¸¤ä¸ªå­—ç¬¦æ‹¼æ¥ <code>\uD83C\uDF00</code> å¾—åˆ° ğŸŒ€</li>
</ul>


<p><figure class='code'><figcaption><span> (EmojiCharacter.java)</span> <a href='/downloads/code/EmojiCharacter.java'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">unicode</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmojiCharacter</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// high offset</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">W1</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="s">&quot;D7C0&quot;</span><span class="o">,</span><span class="mi">16</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// low offset</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">W2</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="s">&quot;DC00&quot;</span><span class="o">,</span><span class="mi">16</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// ğŸŒ€çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤º</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">doughnutBinary</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toBinaryString</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="s">&quot;1F300&quot;</span><span class="o">,</span><span class="mi">16</span><span class="o">));</span>
</span><span class='line'>        <span class="c1">// æ‹†æˆé«˜ä½ 10 ä½è¡¨ç¤º</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">highSetsBinary</span> <span class="o">=</span> <span class="n">doughnutBinary</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">doughnutBinary</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">10</span><span class="o">);</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">lowSetsBinary</span> <span class="o">=</span> <span class="n">doughnutBinary</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">doughnutBinary</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">10</span><span class="o">,</span> <span class="n">doughnutBinary</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">highSetsBinary</span><span class="o">);</span>     <span class="c1">//    1111100</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">lowSetsBinary</span><span class="o">);</span>      <span class="c1">//    1100000000</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// åˆ†åˆ«ä¸åç§»é‡ç›¸åŠ ï¼Œå¾—åˆ°ä¸¤ä¸ªç¼–ç å€¼</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">highSetsHexFixed</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toHexString</span><span class="o">(</span><span class="n">W1</span> <span class="o">+</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">highSetsBinary</span><span class="o">,</span> <span class="mi">2</span><span class="o">));</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">lowSetsHexFixed</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toHexString</span><span class="o">(</span><span class="n">W2</span> <span class="o">+</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">lowSetsBinary</span><span class="o">,</span> <span class="mi">2</span><span class="o">));</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">highSetsHexFixed</span><span class="o">);</span>   <span class="c1">//    d83c</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">lowSetsHexFixed</span><span class="o">);</span>    <span class="c1">//    df00</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// æ‹¼æ¥è¿™ä¸¤ä¸ªç¼–ç å€¼ï¼Œè¿˜åŸå­—ç¬¦è¡¨ç¤º</span>
</span><span class='line'>        <span class="kt">char</span> <span class="n">highChar</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span><span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">highSetsHexFixed</span><span class="o">,</span> <span class="mi">16</span><span class="o">).</span><span class="na">intValue</span><span class="o">();</span>
</span><span class='line'>        <span class="kt">char</span> <span class="n">lowChar</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span><span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">lowSetsHexFixed</span><span class="o">,</span> <span class="mi">16</span><span class="o">).</span><span class="na">intValue</span><span class="o">();</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">highChar</span><span class="o">);</span>           <span class="c1">//    ?     </span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">lowChar</span><span class="o">);</span>            <span class="c1">//    ?</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">highChar</span> <span class="o">+</span> <span class="s">&quot;&quot;</span> <span class="o">+</span> <span class="n">lowChar</span><span class="o">);</span>    <span class="c1">//    ğŸŒ€</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<h2>åˆä½“</h2>

<p>Client å‘é€ <em>Emoji</em> åˆ°åå°ï¼ŒJava å´æ— æ³•é€šè¿‡ JDBC å°†å…¶å­˜å‚¨åˆ° MySQLã€‚å¦‚æœæˆ‘ä»¬éµå¾ªæŸä¸ªç‰¹å®šçš„è½¬æ¢è§„åˆ™ï¼Œå­˜å‚¨å‰è½¬ä¹‰ä¸€æ¬¡ï¼Œè¯»å–æ—¶å†é€†è½¬ä¹‰ä¸€æ¬¡ï¼Œé‚£ä¸å°±å¦¥å¦¥å¦¥çš„äº†ã€‚ä½ å½“ç„¶å¯ä»¥è‡ªå·±å†™ï¼Œä½†æ˜¯æ‡’é€¼å¦‚æˆ‘ï¼Œæ›´å€¾å‘äºæ‰¾<a href="https://github.com/vdurmont/emoji-java/">ç°è´§</a>ã€‚</p>

<h2>å¼•ç”¨</h2>

<ul>
<li><a href="http://cenalulu.github.io/linux/character-encoding">ååˆ†é’Ÿææ¸…å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç </a></li>
<li><a href="http://www.czyborra.com/utf/#Java">Java&rsquo;s Unicode Notation</a></li>
<li><a href="http://stackoverflow.com/questions/2220366/get-unicode-value-of-a-character">Get unicode value of a character</a></li>
<li><a href="http://stackoverflow.com/questions/6617491/how-to-convert-a-string-representation-of-unicode-hex-0x20000-to-the-int-code">Get character of a unicode value</a></li>
<li><a href="http://code.iamcal.com/php/emoji/">Full Emoji Catalog</a></li>
<li><a href="https://github.com/vdurmont/emoji-java/">emoji-java</a></li>
</ul>

<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>MySQL5.5 ç‰ˆæœ¬ä»¥åæœ‰å¯¹ <em>4 bytes</em> å•å­—ç¬¦çš„åŸç”Ÿæ”¯æŒï¼Œå­—ç¬¦é›†é…ç½®ä¸º <em>utf8mb4</em><a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>è¯·çœ‹ååˆ†é’Ÿç³»åˆ—çš„å®ç°ç»†èŠ‚ï¼Œä¸‰å­—èŠ‚çš„ <em>UTF-8</em> ç¼–ç ä¸Šé™æ˜¯ 16 ä½ã€4 + 6 + 6ã€ï¼Œ<code>11111 001100 000000</code> å¯¹åº”çš„ <em>UTF-8</em> ç¼–ç ä¸º <code>11110000 10011111 10001100 10000000</code>ï¼Œå³ <strong>\xF0</strong>&hellip;ï¼ŒMySQL ç»å¸¸ä¼šå†’å‡ºè¿™ç§å¼‚å¸¸<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p>å‹˜è¯¯ï¼Œé€šä¿—ç‰ˆä¸­æ‰€è¯´çš„ W1 : <code>0xD800</code> ä¸å¯¹ï¼Œåº”æ˜¯ <code>0xD7C0</code>ï¼Œå·²åœ¨è¯„è®ºä¸­åæ˜ ç»™åŸä½œè€…<a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
<li id="fn:4">
<p>æ¯”å¦‚ã€âš¡ã€<a href="#fnref:4" rev="footnote">&#8617;</a></p></li>
<li id="fn:5">
<p><em>Unicode</em> é¢„ç•™äº†æ›¿ä»£åŒºåŸŸ <code>\uD800 -- \uDFFF</code> ä½œä¸ºè¾…åŠ©ï¼Œæ­¤åŒºé—´çš„å•ä¸ªå­—ç¬¦æ²¡æœ‰å®é™…è¡¨ç¤ºæ„ä¹‰<a href="#fnref:5" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

]]></content>
  </entry>
  
</feed>
