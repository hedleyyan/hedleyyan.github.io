<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Callback | Hedley]]></title>
  <link href="http://hedleyyan.github.io/blog/categories/callback/atom.xml" rel="self"/>
  <link href="http://hedleyyan.github.io/"/>
  <updated>2015-09-15T16:37:44+08:00</updated>
  <id>http://hedleyyan.github.io/</id>
  <author>
    <name><![CDATA[hedley]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[è´Ÿè´£ä»»å†è°ˆ Callback ä¸ Delegation]]></title>
    <link href="http://hedleyyan.github.io/blog/2015/07/18/fu-ze-ren-zai-tan-callback-yu-delegation/"/>
    <updated>2015-07-18T15:03:11+08:00</updated>
    <id>http://hedleyyan.github.io/blog/2015/07/18/fu-ze-ren-zai-tan-callback-yu-delegation</id>
    <content type="html"><![CDATA[<h1>å¼•å‡º</h1>

<p>è¯æ¥ä¸Šå›<a href="/blog/2015/07/10/zhuang-shi-zhe-mo-shi-decorate-pattern-yu-hui-diao-ji-zhi-callback-framework/">ä¸è´Ÿè´£çè¯´è¯´ Patterns ä¸ Frameworks</a>ï¼Œè¿˜è°ˆå¼•å‡ºé—®é¢˜ï¼š<em>Wrapper classes are not suited for use in callback frameworks</em>ã€‚è™½ç„¶æœ€åç»™å‡ºäº†ä¸€ä¸ªå¯ä»¥éªŒè¯çš„ <em>Demo Code</em>ï¼Œä½†æ˜¯ä¸ªä¸­ç¼˜ç”±ä»å½±å½±ç»°ç»°ï¼ŒçœŸç›¸ä»¿ä½›éš”ç€ä¸€å±‚è–„çº±åœ¨å‘æˆ‘æ‹›æ‰‹ã€‚å¿ƒæ€¥éš¾è€ï¼Œé‚ä»å¼•å‡º <em>SELF problem</em> çš„è®ºæ–‡å‡ºå‘ï¼Œé¡ºè—¤æ‘¸ç“œæŒ‰å›¾ç´¢éª¥ï¼Œä¹Ÿè®¸æ˜¯æˆ‘çš„çœŸå¿ƒæ‰“åŠ¨äº†ä¸Šå¤©ï¼Œä¹Ÿè®¸æ˜¯æˆ‘å¤ªå¸…ï¼Œå¹¸å¾— <a href="http://blog.csdn.net/yqj2065">yqj2065</a> è€å¸ˆæŒ‡ç‚¹ï¼Œæ‰æŠŠçœŸç›¸æŠ±äº†ä¸ªæ»¡æ€€ã€‚</p>

<p>å¹¸ç¦æ¥çš„å¤ªå¿«ï¼Œè™šå¹»åˆä¸çœŸå®ï¼Œä¹Ÿè®¸æˆ‘çœ‹åˆ°çš„åªæ˜¯èƒŒå½±ï¼Œåˆæˆ–è®¸æˆ‘çœ‹åˆ°çš„æ˜¯åºå±±çœŸé¢ï¼Œæ”¾ç©ºæ€ç»ªï¼Œå®¹æˆ‘ä¸€ç‚¹ç‚¹å›å¿†ã€‚ä¸çŸ¥é“å¾…æˆ‘ä»æ±‚çŸ¥è·¯ä¸Šèµ°çš„æ›´è¿œï¼Œå›å¤´å†çœ‹ä»Šå¤©çš„â€œè´Ÿè´£ä»»â€æ˜¯ä¸æ˜¯å¤Ÿç‚«é…·å‘¢ã€‚</p>

<p>å…ˆç”©å¤§æ‹›ä¸Šç»“è®º</p>

<ul>
<li>Java ä¸æ”¯æŒ <em>delegation</em></li>
<li>C# çš„ <em>delegate</em> ä¸æ˜¯çœŸæ­£çš„ <em>delegate</em></li>
<li><a name="æƒ³æ³•"><em>delegation</em> ï¼šæˆ‘åªéœ€è¦ä½ çš„åŸå‹æ–¹æ³•ï¼Œä½†æˆ‘ä¸è¦ä¾èµ–äºä½  </a></li>
</ul>


<!--more-->


<h1>çº¿ç´¢</h1>

<p>å†™å®Œä¸Šæ¬¡çš„â€œä¸è´Ÿè´£ä»»â€ï¼Œæ„Ÿè§‰ä¸çˆ½ï¼Œå› ä¸º <em>SELF problem</em> è®ºæ–‡ [<a href="https://static.aminer.org/pdf/PDF/000/522/451/using_prototypical_objects_to_implement_shared_behavior_in_object_oriented.pdf">Using Prototypical Objects to Implement Shared Behavior in Object Oriented Systems</a>] é‡Œè¿˜æœ‰ç†è§£ä¸äº†çš„ç‚¹ï¼Œ<em>Wrapper classes are not suited for use in callback frameworks</em> è¿™ä¸ªé—®é¢˜æ„Ÿè§‰ç†è§£çš„è¿˜å¯ä»¥ï¼Œä½†æ˜¯ç›¸åº”çš„ï¼Œè®ºæ–‡é‡Œæåˆ°çš„ <em>delegation</em> ä¸ºä»€ä¹ˆå°± OK å‘¢ï¼Ÿè®ºæ–‡é‡Œè¯´çš„è¿™ä¸ª <em>delegation</em> åˆæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>

<p>é¡ºç€è®ºæ–‡é‡Œæåˆ°çš„ <em>delegation appearing several in Lisp-based object oriented systems..</em> è°ƒæŸ¥äº†ä¸€ä¸‹ <em>Lisp</em> è¯­è¨€çš„èƒŒæ™¯ã€‚</p>

<p>çœ‹åˆ°äº† <em>Lisp</em> çš„è¯­æ³•ä»¥åï¼Œå¿½æ„Ÿå’Œ <em>Java8 lambda</em> è¡¨è¾¾å¼é•¿çš„å¾ˆåƒã€‚äºæ˜¯å†æŸ¥ <em>Java8 lambda</em> æ˜¯ä¸æ˜¯å°±æ˜¯æˆ‘å›°æƒ‘çš„é‚£ä¸ª <em>delegation</em>ã€‚</p>

<p>äº†è§£äº† <em>Java8 lambda</em> çš„æœºåˆ¶ï¼Œå¹¶æŸ¥åˆ°äº†è¾ƒå¯ä¿¡çš„<a href="http://stackoverflow.com/questions/44912/java-delegates#comment13546516_44916">è¯æ®</a>è¯´ <em>Java8 lambda</em> ä¸æ˜¯ <em>delegation</em>ï¼Œå¹¶ä¸”ä»¥å Java éƒ½ä¸ä¼šæ”¯æŒ <em>delegation</em>ã€‚</p>

<p>ä½†æ˜¯ä¸Šé¢çš„ä¿¡æ¯ä¸­æåˆ° C# æ˜¯å®ç°äº† <em>delegate</em> çš„ã€‚ç„¶åäº†è§£äº† C# çš„ <em>delegate</em>ã€<em>event</em> å…³é”®å­—ï¼Œå†™äº†äº›ä»£ç æ¥éªŒè¯æˆ‘çš„<a href="#%E6%83%B3%E6%B3%95">æƒ³æ³•</a>ã€‚</p>

<p>ä½†æ˜¯å¾ˆä¸å¹¸ï¼Œæ²¡æœ‰éªŒè¯æˆåŠŸã€‚æˆ‘å‘ç° C# çš„ <em>delegate</em> å…¶å®å’Œ <em>Java8 lambda</em> æ˜¯ä¸€æ ·çš„åŸç†ï¼Œä¸è¿‡æ˜¯ä¸€ç§æ›´æ–¹ä¾¿çš„è¯­æ³•åŠ ä¸Šæ›´çµæ´»çš„å®ç°ã€‚</p>

<p>æ‰€ä»¥åˆå›å¤´å¼€å§‹ç† <em>SELF problem</em> è®ºæ–‡ï¼Œåˆ°åº•æ˜¯å“ªé‡Œä¸ä¸€è‡´ã€‚å¼€å§‹æ€€ç–‘ C# çš„ <em>delegate</em> å’Œè®ºæ–‡é‡Œè¯´çš„ <em>delegation</em> ä¸æ˜¯ä¸€ä¸ªé¢‘é“ã€‚</p>

<p>å¤ªå¸…äº†ï¼Œåˆæ‰¾åˆ°äº†è¯æ®ã€‚</p>

<p>ä½†æ˜¯æ›´å¸…çš„æ˜¯ï¼Œæˆ‘ææ‡‚äº† <em>Callback</em>ã€‚</p>

<h1>çœŸÂ· <em>Callback</em></h1>

<p><img class="right" src="/images/Snip20150719_6.png" width="400" height="300"></p>

<p>ä¸Šå›ç»™ <em>callback</em> ä¸‹çš„ä¸€å¥è¯å®šä¹‰ï¼š<em>If you call me, i will call back.</em>  Wellï¼Œä¸¢æ‰å¿˜æ‰æ‰”åˆ°åƒåœ¾æ¡¶ã€‚çµæ„Ÿæ¥è‡ª<a href="http://blog.csdn.net/yqj2065/article/details/39481255">è¿™é‡Œ</a>ï¼Œè¯šå¦‚æˆ‘ä¸‹é¢çš„ç•™è¨€ï¼šæ‹¨äº‘è§æ—¥é†é†çŒé¡¶ï¼Œç—›å¿«ï¼</p>

<p>é¦–å…ˆï¼Œ <em>callback</em> æ˜¯åè¯ï¼Œä¸æ˜¯åŠ¨è¯ï¼Œä¸æ˜¯åœºæ™¯ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ˜¯å›è°ƒå‡½æ•°çš„ç®€ç§°ã€‚</p>

<p>å…¶æ¬¡ï¼Œ <em>callback</em> å¼ºè°ƒä¸Šä¸‹æ–‡ï¼Œæœ‰ä¸€ä¸ªåˆ†å±‚çš„æ¦‚å¿µåœ¨ã€‚å¦‚æœæ˜¯åŒä¸€å±‚ä¸­çš„è°ƒç”¨ï¼Œå°±å˜æˆäº†æ™®é€šçš„ä¾èµ–å…³ç³»ï¼Œå¤šæ€çš„æ¦‚å¿µã€‚ <em>callback</em> æ˜¯ç‰¹æ®Šåœºæ™¯çš„å¤šæ€åº”ç”¨ã€‚</p>

<p>äº†è§£äº†è¿™ä¸¤ç‚¹ä¹‹åï¼Œç†è§£èµ·æ¥ç®€ç›´æ˜¯çˆ½ï¼Œä¸€å¼ ç±»å›¾æå®šã€‚</p>

<p><blockquote><p>ä¸€ä¸ªå›è°ƒå‡½æ•° / æ–¹æ³•ï¼ˆç®€ç§°å›è°ƒ / callbackï¼‰æ˜¯ä¸Šå±‚æ¨¡å—å®ç°çš„ï¼Œå°†è¢«ä¸‹å±‚æ¨¡å—ï¼ˆåè¿‡æ¥ï¼‰æ‰§è¡Œçš„æ–¹æ³•ã€‚</p></blockquote></p>

<p>å¯è§æ‰€è°“ <em>framework</em>ï¼Œæ ¹æœ¬å°±æ˜¯å»ºç«‹åœ¨ <em>callback</em> çš„åŸºç¡€ä¸Šçš„ã€‚æˆ‘ä»¬è¦æƒ³åšå¡«ç©ºé¢˜ï¼Œé‚£ä¹ˆ <em>framework</em> å°è£…çš„ç»†èŠ‚æ˜¯å¦‚ä½•è°ƒç”¨æˆ‘ä»¬çš„ä»£ç çš„å‘¢ï¼Ÿ <em>callback</em>ï¼<em><a href="/blog/2015/07/10/zhuang-shi-zhe-mo-shi-decorate-pattern-yu-hui-diao-ji-zhi-callback-framework/#inversion-of-control">Hollywood principle</a></em> å¼ºè°ƒçš„æ­£æ˜¯ <em>callback</em> çš„ä½¿ç”¨æƒ…æ™¯ï¼šä½ ï¼ˆä¸Šå±‚ <em>Client</em>ï¼‰ä¸éœ€è¦æ¥è¯¢é—®æˆ‘ï¼ˆåº•å±‚ <em>Server</em>ï¼‰äº‹ä»¶æ˜¯ä¸æ˜¯å‘ç”Ÿäº†ï¼Œå‘ç”Ÿäº†æˆ‘ä¼šé€šçŸ¥ä½ ï¼ˆé€šè¿‡ <em>callback</em>ï¼‰ã€‚</p>

<h1>ä¼ªÂ· <em>Delegation</em></h1>

<p><blockquote><p>Worse still, almost every reference youâ€™ll find for &ldquo;delegation&rdquo; shows you examples of just object collaboration with message forwarding. They are examples of plain old method calls and not delegation.</p></blockquote></p>

<p><a href="http://www.saturnflyer.com/blog/jim/2012/07/06/the-gang-of-four-is-wrong-and-you-dont-understand-delegation/">The Gang Of Four Is Wrong And You Don&rsquo;t Understand Delegation</a> æ˜¯æœ€è®©æˆ‘æ„ŸåŠ¨çš„çº¿ç´¢ï¼Œä¹‹å‰å„ç§å‡­ç©ºçŒœæƒ³çš„ <em>delegation</em> åˆ°åº•æ˜¯ä½•å®ç°ç»ˆäºå¯ä»¥å°˜åŸƒè½å®šã€‚åŸºæœ¬ä¸Šæ‰€æœ‰çš„ä¼ª <em>delegation</em> éƒ½æ˜¯ <em>composite</em> åŠ  <em>message forward</em>ï¼ŒåŒ…æ‹¬ Javaï¼ŒåŒ…æ‹¬ C# å’Œ C++ã€‚ <em>delegation</em> ä¸å¯èƒ½é€šè¿‡ <em>Design Pattern</em> å¾—åˆ°å®ç°ã€‚</p>

<h2>C# <em>delegate</em></h2>

<p><a href="http://www.akadia.com/services/dotnet_delegates_and_events.html#The%20Second%20Change%20Event%20Example">Delegates and Events in C# / .NET</a> ä¾‹å­å¾ˆæ£’ï¼Œç®€ç®€å•å•è¯´æ˜ç™½äº† C# ä¸­çš„ delegate å’Œ event çš„åŸç†ï¼Œç„¶åä½ ä¼šå‘ç°å®ƒå’Œ Java çš„å„ç§å……æ»¡ <em>Listeners</em> / <em>Handlers</em> çš„ä»£ç æ„æ€å¤§åŒå°å¼‚ã€‚ä¾‹å­ä¸­çš„ä»£ç å®Œå…¨å¯ä»¥ç”¨ Java å®ç°ï¼Œä¸€ä¸ª <em>callback</em> æå®šã€‚</p>

<p><figure class='code'><figcaption><span> (DelegationTest.java)</span> <a href='/downloads/code/DelegationTest.java'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">Clock</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">_hour</span><span class="o">,</span> <span class="n">_minute</span><span class="o">,</span> <span class="n">_second</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">SecondChangeHandler</span><span class="o">&gt;</span> <span class="n">listeners</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">SecondChangeHandler</span><span class="o">&gt;();</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">Calendar</span> <span class="n">now</span> <span class="o">=</span> <span class="n">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
</span><span class='line'>            <span class="kt">int</span> <span class="n">hour</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Calendar</span><span class="o">.</span><span class="na">HOUR_OF_DAY</span><span class="o">);</span>
</span><span class='line'>            <span class="kt">int</span> <span class="n">minute</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Calendar</span><span class="o">.</span><span class="na">MINUTE</span><span class="o">);</span>
</span><span class='line'>            <span class="kt">int</span> <span class="n">second</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">Calendar</span><span class="o">.</span><span class="na">SECOND</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">second</span> <span class="o">!=</span> <span class="n">_second</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">TimeInfoEventArgs</span> <span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">TimeInfoEventArgs</span><span class="o">(</span><span class="n">hour</span><span class="o">,</span> <span class="n">minute</span><span class="o">,</span> <span class="n">second</span><span class="o">);</span>
</span><span class='line'>                <span class="n">onSecondChange</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// update the time</span>
</span><span class='line'>            <span class="n">_hour</span> <span class="o">=</span> <span class="n">hour</span><span class="o">;</span>
</span><span class='line'>            <span class="n">_minute</span> <span class="o">=</span> <span class="n">minute</span><span class="o">;</span>
</span><span class='line'>            <span class="n">_second</span> <span class="o">=</span> <span class="n">second</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="n">SecondChangeHandler</span> <span class="n">listener</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">listeners</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">listener</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onSecondChange</span><span class="o">(</span><span class="n">Object</span> <span class="n">clock</span><span class="o">,</span> <span class="n">TimeInfoEventArgs</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="n">SecondChangeHandler</span> <span class="n">listener</span> <span class="o">:</span> <span class="n">listeners</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">listener</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">clock</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">TimeInfoEventArgs</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">private</span> <span class="kt">int</span> <span class="n">hour</span><span class="o">,</span> <span class="n">minute</span><span class="o">,</span> <span class="n">second</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">public</span> <span class="nf">TimeInfoEventArgs</span><span class="o">(</span><span class="kt">int</span> <span class="n">hour</span><span class="o">,</span> <span class="kt">int</span> <span class="n">minute</span><span class="o">,</span> <span class="kt">int</span> <span class="n">second</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">this</span><span class="o">.</span><span class="na">hour</span> <span class="o">=</span> <span class="n">hour</span><span class="o">;</span>
</span><span class='line'>            <span class="k">this</span><span class="o">.</span><span class="na">minute</span> <span class="o">=</span> <span class="n">minute</span><span class="o">;</span>
</span><span class='line'>            <span class="k">this</span><span class="o">.</span><span class="na">second</span> <span class="o">=</span> <span class="n">second</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getHour</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">hour</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMinute</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">minute</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSecond</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">second</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">interface</span> <span class="nc">SecondChangeHandler</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Object</span> <span class="n">sender</span><span class="o">,</span> <span class="n">TimeInfoEventArgs</span> <span class="n">args</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">class</span> <span class="nc">DisplayClock</span> <span class="kd">implements</span> <span class="n">SecondChangeHandler</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Object</span> <span class="n">sender</span><span class="o">,</span> <span class="n">TimeInfoEventArgs</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Current Time: %d:%d:%d&quot;</span><span class="o">,</span> <span class="n">args</span><span class="o">.</span><span class="na">getHour</span><span class="o">(),</span> <span class="n">args</span><span class="o">.</span><span class="na">getMinute</span><span class="o">(),</span> <span class="n">args</span><span class="o">.</span><span class="na">getSecond</span><span class="o">()));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">class</span> <span class="nc">LogClock</span> <span class="kd">implements</span> <span class="n">SecondChangeHandler</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">Object</span> <span class="n">sender</span><span class="o">,</span> <span class="n">TimeInfoEventArgs</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;Logging to file: %d:%d:%d&quot;</span><span class="o">,</span> <span class="n">args</span><span class="o">.</span><span class="na">getHour</span><span class="o">(),</span> <span class="n">args</span><span class="o">.</span><span class="na">getMinute</span><span class="o">(),</span> <span class="n">args</span><span class="o">.</span><span class="na">getSecond</span><span class="o">()));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DelegationTest</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Clock</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Clock</span><span class="o">();</span>
</span><span class='line'>        <span class="n">SecondChangeHandler</span> <span class="n">dh</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">DisplayClock</span><span class="o">();</span>
</span><span class='line'>        <span class="n">SecondChangeHandler</span> <span class="n">lh</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">LogClock</span><span class="o">();</span>
</span><span class='line'>        <span class="n">c</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">dh</span><span class="o">);</span>
</span><span class='line'>        <span class="n">c</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">lh</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">c</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>ä½†æ˜¯ C# çš„ delegate æœºåˆ¶æ¯” Java çš„æ›´çµæ´»ï¼Œå› ä¸º delegate å¯ä»¥è¢«â€œå§”æ‰˜â€å¤šä¸ªä¸åŒæ–¹æ³•ï¼Œè€Œè¿™äº›æ–¹æ³•åªéœ€è¦æœ‰ç›¸åŒçš„ <code>signature</code> å’Œè¿”å›å€¼ï¼Œå¹¶ä¸éœ€è¦æ˜¯åŒä¸€ä¸ªæ¥å£çš„å£°æ˜ï¼Œæ‰€ä»¥ä¸€ä¸ªç±»ä¸­çš„å¤šä¸ªæ–¹æ³•éƒ½å¯ä»¥â€œå§”æ‰˜â€å®ƒã€‚Java å¹¶æ²¡æœ‰è¿™ç§åŸç”Ÿæ”¯æŒï¼Œ<a href="http://www.onjava.com/pub/a/onjava/2003/05/21/delegates.html">A Java Programmer Looks at C# Delegates</a> æœ‰å¦‚ä½•ç”¨ Java æ¨¡æ‹Ÿ C# delegate çš„å®ç°ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹ï¼Œé‚£æ˜¯ç›¸å½“è´¹åŠ²ã€‚</p>

<h2><em>Java8 lambda</em> è¡¨è¾¾å¼</h2>

<p><blockquote><p>It is unlikely that the Java programming language will ever include this construct. Sun already carefully considered adopting it in 1996, to the extent of building and discarding working prototypes. Our conclusion was that bound method references are unnecessary and detrimental to the language. This decision was made in consultation with Borland International, who had previous experience with bound method references in Delphi Object Pascal.</p></p><p><p>We believe bound method references are unnecessary because another design alternative, inner classes, provides equal or superior functionality. In particular, inner classes fully support the requirements of user-interface event handling, and have been used to implement a user-interface API at least as comprehensive as the Windows Foundation Classes.</p></p><p><p>We believe bound method references are harmful because they detract from the simplicity of the Java programming language and the pervasively object-oriented character of the APIs. Bound method references also introduce irregularity into the language syntax and scoping rules. Finally, they dilute the investment in VM technologies because VMs are required to handle additional and disparate types of references and method linkage efficiently.</p></blockquote></p>

<p>Java å®˜æ–¹å¾ˆæ—©å°±å£°æ˜äº†å…¶ä¸ä¼šæ”¯æŒ <em>delegate</em>ï¼ˆè¿™é‡ŒæŒ‡ C# çš„ <em>delegate</em>ï¼‰ã€‚Sun ç›¸ä¿¡å¯ä»¥é€šè¿‡å†…éƒ¨ç±»å®ç°éœ€è¦çš„åŠŸèƒ½ï¼Œ<em>method reference</em> ä¼šç ´å Java çš„ <em>simplicity</em>ã€‚å¯¹ Java çš„ç®€å•ç‰¹æ€§è¡¨ç¤ºç²‰èµğŸ‘ã€‚</p>

<p><em>Java8 lambda</em> çš„å‡ºç°è§£å†³äº†å†…éƒ¨ç±»çš„è‡ƒè‚¿å†™æ³•ï¼Œè¯­æ³•æ›´æ¸…å‡‰ï¼Œå£æ„Ÿæ›´é…¸çˆ½ï¼Œæ›´é‡è¦çš„æ˜¯å…¶å¯åˆ©ç”¨å†…éƒ¨å¾ªç¯ï¼ˆ<code>for</code> æ˜¯å¤–éƒ¨å¾ªç¯ï¼‰å……åˆ†åˆ©ç”¨å¤šå¤„ç†å™¨ã€‚ä½†å…¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªåŒ¿åæ–¹æ³•ï¼Œå¹¶ä¸æ˜¯ <em>method reference</em>ï¼Œä¸èµ˜è¿°æ›´å¤šç»†èŠ‚ã€‚</p>

<h3><em>Monad</em></h3>

<p><blockquote><p>In functional programming, a monad is a structure that represents computations defined as sequences of steps: a type with a monad structure defines what it means to chain operations, or nest functions of that type together.</p></blockquote></p>

<p><em>Monad</em> æœ¬æ˜¯å‡½æ•°ç¼–ç¨‹è¯­è¨€ä¸­çš„é«˜çº§ç‰¹æ€§ï¼Œ<em>Java8 lambda</em> çš„å‡ºç°å´è®©äººä¸ç”±è‡ªä¸»çš„æŠŠä»–ä»¬è”æƒ³åˆ°ä¸€èµ·ã€‚<a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html">è¿™ç¯‡æ£’æ£’çš„å¼•å‡ºæ•™ç¨‹</a>å®Œç¾è¯ é‡Šäº†ä»€ä¹ˆå«ä¸€å¼ å›¾èƒœè¿‡åƒè¨€ä¸‡è¯­ï¼Œè™½ç„¶æˆ‘æ²¡å¾€ç»†é‡Œçœ‹ <em>Monad</em>ï¼Œä½†è¿™ç¯‡æ–‡ç« é‡Œçš„å›¾å€Ÿæ¥ç†è§£ <em>Java8 lambda</em> çš„å†…éƒ¨å¾ªç¯ä¹Ÿæ˜¯æå¥½çš„ã€‚</p>

<p><img src="/images/monad/fmap_just.png">
<img src="/images/monad/fmap_list.png">
<img src="/images/monad/monad_chain.png"></p>

<p>é€šè¿‡ <em>Java8 lambda</em> ä¹Ÿå¯ä»¥å®ç°åˆçº§çš„ <em>Monad</em>ï¼Œè„‘æ´ç•¥å¤§æš‚ä¸åšç»†è¡¨ã€‚</p>

<h1>çœŸÂ· <em>Delegation</em></h1>

<p><blockquote><p>Delegation removes the distinction between classes and instances. Any object can serve as a prototype. To create an object that shares knowledge with a prototype, you construct an extension object, which has a list containing its prototypes which may be shared with other objects, and personal behavior idiosyncratic to the object itself. When an extension object receives a message, it first attempts to respond to the message using the behavior stored in its personal part. If the object&rsquo;s personal characteristics are not relevant for answering the message, the object forwards the message on to the prototypes to see if one can respond to the message. This process of forwarding is called delegating the message.</p><footer><strong>Lieberman86</strong></footer></blockquote></p>

<p><em>delegation</em> æ˜¯å»ºç«‹åœ¨ <em>prototype object</em> çš„åŸºç¡€ä¸Šçš„ï¼Œä»¥ <em>class</em> ä¸ºåŸºç¡€çš„ <em>inheritance system</em> ä¸èƒ½å®ç° <em>delegation</em>ã€‚</p>

<p><em>delegation</em> å’Œ <em>message forward</em> åŒºåˆ«çš„å”¯ä¸€æ ‡å‡†å°±æ˜¯<strong>æœ€ç»ˆæ‰§è¡Œçš„æ–¹æ³• M å†…æ˜¯å¦å¯ä»¥å¼•ç”¨åˆ°æœ€åˆå‘èµ·è¯·æ±‚çš„å¯¹è±¡ O</strong>ï¼Œæ›´ç®€å•ç²—æš´ä¸€ç‚¹ï¼š<strong>M å†…çš„ <code>this</code> æ˜¯ä¸æ˜¯æŒ‡ä»£ O</strong>ã€‚[<em>SELF problem</em>]</p>

<h2><em>Javascript</em></h2>

<p>äº†è§£çš„è¯­è¨€å°‘æ˜¯çŸ­æ¿ï¼Œå¦‚æœæ—©äº†è§£äº† <em>Javascript</em> çš„å¤§æ¦‚æœºåˆ¶å’Œè¯­æ³•ï¼Œå°‘ç»•å¤šå¤§ä¸€åœˆå­å•Šã€‚</p>

<pre><code class="javascript">function Container(){};
Container.prototype = new Object();
Container.prototype.announce = function(){ alert("these are my things: " + this.things) };

function Bucket(things){this.things = things};
Bucket.prototype = new Container();

bucket = new Bucket("planes, trains, and automobiles")
bucket.announce() // alerts "these are my things: planes, trains, and automobiles"
</code></pre>

<h1>ä¹±å…¥ <em>delegate</em> çš„ <em>Patterns</em></h1>

<p>ç”±äº GoF åœ¨è®¾è®¡æ¨¡å¼ä¸­å¤§èŒƒå›´æ€ä¼¤å¼çš„ä½¿ç”¨äº† <em>delegation</em> ä¸€è¯ï¼Œå„ç§ <em>pattern</em> ä¸­çš„å„ç§ <em>delegate</em> ä¹±å…¥æ»¡å¤©é£ä¸€ç›´æµä¼ è‡³ä»Šã€‚å½“ç„¶å®ƒä»¬éƒ½æ˜¯ <em>message forward</em> å’Œ <em>composite</em> çš„ç»“åˆä½“ã€‚</p>

<h2><em>Decorator Pattern</em> å’Œ <em>Proxy Pattern</em></h2>

<p><blockquote><p>Decorator Pattern focuses on dynamically adding functions to an object, while Proxy Pattern focuses on controlling access to an object.</p></blockquote></p>

<p>ç»¼åˆ <a href="http://stackoverflow.com/questions/18618779/differences-between-proxy-and-decorator-pattern">Differences between Proxy and Decorator Pattern</a> æ‰€æœ‰å›ç­”çš„æ„è§ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ªæ¯”è¾ƒå…¨é¢çš„ç»“è®ºã€‚</p>

<p>è£…é¥°è€…æ¨¡å¼å’Œä»£ç†æ¨¡å¼çš„ç±»å›¾çœ‹ä¸Šå»æ²¡ä»€ä¹ˆå·®ï¼Œä»–ä»¬çš„åŒºåˆ«ä¸»è¦åœ¨ç›®çš„ã€‚ä»£ç†æ¨¡å¼ä¸­ï¼Œä»£ç†ç±»å¯¹è¢«ä»£ç†çš„å¯¹è±¡æœ‰æ§åˆ¶æƒï¼Œå†³å®šå…¶æ‰§è¡Œæˆ–è€…ä¸æ‰§è¡Œã€‚è€Œè£…é¥°æ¨¡å¼ä¸­ï¼Œè£…é¥°ç±»å¯¹ä»£ç†å¯¹è±¡æ²¡æœ‰æ§åˆ¶æƒï¼Œåªèƒ½ä¸ºå…¶å¢åŠ ä¸€å±‚è£…é¥°ï¼Œä»¥åŠ å¼ºè¢«è£…é¥°å¯¹è±¡çš„åŠŸèƒ½ã€‚</p>

<h3><em>Dynamic Proxy</em></h3>

<p>è®¾æƒ³ä¸€ä¸ªè¢«ä»£ç†çš„å¯¹è±¡æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒçš„ä»£ç†ç±»çœ‹ä¸Šå»å¯èƒ½å°±å¾ˆåƒä¸Šå›æåˆ°çš„<a href="/blog/2015/07/10/zhuang-shi-zhe-mo-shi-decorate-pattern-yu-hui-diao-ji-zhi-callback-framework/#forward">è¿™æ®µä»£ç </a>ã€‚è€Œæˆ‘ä»¬æƒ³è¦å®ç°çš„ä¸€ä¸ªä»£ç†å…¶æƒé™åˆ¤æ–­å¾ˆé›†ä¸­ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯æŠŠè¿™æ®µé›†ä¸­çš„æƒé™æ§åˆ¶çš„ä»£ç å‰¥ç¦»å‡ºæ¥ï¼Œæ„Ÿè§‰ä¸–ç•Œä¼šæ›´ç¾å¥½å‘¢ã€‚</p>

<p><code>java.lang.reflect</code> åŒ…ä¸‹çš„ <code>InvocationHandler</code> å’Œ <code>Proxy</code> ç±»å¯¹åŠ¨æ€ä»£ç†æä¾›æ”¯æŒï¼Œæˆ‘ä»¬åªéœ€è¦æä¾›ä¸€ä¸ª <code>InvocationHandler</code> çš„å®ä¾‹æ¥å¤„ç†é›†ä¸­çš„æƒé™æ§åˆ¶é€»è¾‘å°±å¥½ã€‚</p>

<h1>æ€»ç»“</h1>

<p>å¼•ç”¨ä¸€æ®µç™¾åº¦çš„å§”æ‰˜å’Œä»£ç†çš„åŒºåˆ«ä½œä¸ºæ€»ç»“ï¼Œæƒ³æ¥å­¦ä¼šå†™ä»£ç è€ƒä¸ªå¾‹å¸ˆåº”è¯¥ä¹Ÿä¸æ˜¯å¤ªéš¾çš„äº‹ã€‚</p>

<p><blockquote><p>æ‰€è°“ä»£ç†ï¼Œå°±æ˜¯æŒ‡ä¸€æ–¹æˆäºˆä»–æ–¹ä»£ç†æƒï¼Œä»–æ–¹ä¾ä»£ç†æƒä¸ç¬¬ä¸‰æ–¹è¿›è¡Œæ³•å¾‹è¡Œä¸ºï¼Œå…¶è¡Œä¸ºåæœç”±ä¸€æ–¹æ‰¿æ‹…çš„ä¸€ç§æ°‘äº‹æ³•å¾‹åˆ¶åº¦ã€‚å§”æ‰˜æ˜¯ä¸€æ–¹å°†ä¸€å®šçš„äº‹åŠ¡å§”è¯¸äºå¦ä¸€æ–¹å®æ–½çš„æ³•å¾‹åˆ¶åº¦ã€‚</p></p><p><p>å§”æ‰˜å’Œä»£ç†çš„åŒºåˆ«åœ¨äºï¼šç¬¬ä¸€ï¼Œå§”æ‰˜è§„èŒƒçš„æ˜¯å§”æ‰˜äººå’Œå—æ‰˜äººåŒæ–¹ä¹‹é—´çš„å…³ç³»ï¼›è€Œä»£ç†è§„èŒƒçš„æ˜¯æœ¬äººã€ä»£ç†äººå’Œç¬¬ä¸‰äººçš„å…³ç³»ã€‚ç¬¬äºŒï¼Œä»£ç†å…³ç³»ä¸­ä»£ç†äººä»£ç†çš„å¯¹è±¡æ˜¯è¿›è¡Œæ„æ€è¡¨ç¤ºå’Œæ¥å—æ„æ€è¡¨ç¤ºçš„è¡Œä¸ºï¼›è€Œå§”æ‰˜ä¸­å—æ‰˜äººä»£ä¸ºå®æ–½çš„è¡Œä¸ºå¯ä»¥æ˜¯æ³•å¾‹è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥æ˜¯äº‹å®è¡Œä¸ºã€‚ç¬¬ä¸‰ï¼Œä»£ç†åŒ…æ‹¬å¯¹å†…å’Œå¯¹å¤–ä¸¤ç§å…³ç³»ï¼Œå¯¹å†…æ˜¯ä»£ç†äººå’Œè¢«ä»£ç†äººä¹‹é—´çš„å…³ç³»ï¼Œè€Œå¯¹å¤–æ˜¯ä»£ç†äººå’Œç¬¬ä¸‰äººä¹‹é—´çš„å…³ç³»ï¼›è€Œå§”æ‰˜åªæ˜¯å§”æ‰˜äººå’Œå—æ‰˜äººä¹‹é—´çš„å…³ç³»ã€‚</p></blockquote></p>

<h1>æ‰©å±•é˜…è¯»</h1>

<ul>
<li><a href="https://static.aminer.org/pdf/PDF/000/522/451/using_prototypical_objects_to_implement_shared_behavior_in_object_oriented.pdf">Using Prototypical Objects to Implement Shared Behavior in Object Oriented Systems</a></li>
<li><a href="https://en.wikipedia.org/wiki/Prototype-based_programming">Prototype-based Programming</a></li>
<li><a href="http://stackoverflow.com/questions/44912/java-delegates#comment13546516_44916">Java Delegates?</a></li>
<li><a href="http://stackoverflow.com/questions/20311779/is-there-delegate-in-java-8-jdk8/30925223#30925223">Is there delegate in Java 8 (JDK8)?</a></li>
<li><a href="http://stackoverflow.com/questions/1746332/delegates-and-callbacks">C# does not implement delegates</a></li>
<li><a href="http://www.saturnflyer.com/blog/jim/2012/07/06/the-gang-of-four-is-wrong-and-you-dont-understand-delegation/">The Gang Of Four Is Wrong And You Don&rsquo;t Understand Delegation</a></li>
<li><a href="http://blog.csdn.net/yqj2065/article/details/39481255">ã€Šç¼–ç¨‹å¯¼è®ºï¼ˆJavaï¼‰Â·9.3.1Javaå›è°ƒã€‹1</a></li>
<li><a href="http://blog.csdn.net/yqj2065/article/details/31441221">ã€Šç¼–ç¨‹å¯¼è®ºï¼ˆJavaï¼‰Â·9.3.1Javaå›è°ƒã€‹2</a></li>
<li><a href="http://www.onjava.com/pub/a/onjava/2003/05/21/delegates.html">A Java Programmer Looks at C# Delegates</a></li>
<li><a href="http://www.akadia.com/services/dotnet_delegates_and_events.html#The%20Second%20Change%20Event%20Example">Delegates and Events in C# / .NET</a></li>
<li><a href="http://stackoverflow.com/questions/18618779/differences-between-proxy-and-decorator-pattern">Differences between Proxy and Decorator Pattern</a></li>
<li><a href="http://stackoverflow.com/questions/44965/what-is-a-monad">What is a monad?</a>

<ul>
<li><a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html">Functors, Applicatives, And Monads In Pictures</a></li>
<li><a href="http://blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.html">You Could Have Invented Monads! (And Maybe You Already Have.)</a></li>
<li><a href="http://www.jdon.com/idea/java8-monad.html">Java8 çš„ Monad</a></li>
</ul>
</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¸è´Ÿè´£çè¯´è¯´ Patterns ä¸ Frameworks]]></title>
    <link href="http://hedleyyan.github.io/blog/2015/07/10/zhuang-shi-zhe-mo-shi-decorate-pattern-yu-hui-diao-ji-zhi-callback-framework/"/>
    <updated>2015-07-10T17:11:00+08:00</updated>
    <id>http://hedleyyan.github.io/blog/2015/07/10/zhuang-shi-zhe-mo-shi-decorate-pattern-yu-hui-diao-ji-zhi-callback-framework</id>
    <content type="html"><![CDATA[<h1>å¼•å‡º</h1>

<p><a href="https://books.google.com.hk/books?id=ka2VUBqHiWkC&amp;pg=PA85&amp;dq=The+disadvantage+of+wrapper+classes&amp;hl=en&amp;sa=X&amp;ved=0CB0Q6AEwAGoVChMI5L-T5PnPxgIVCQuOCh1joQq6#v=onepage&amp;q=The%20disadvantage%20of%20wrapper%20classes&amp;f=false">Effective Java, Item 16</a> ä¸­è¯´ <em>Wrapper classes are not suited for use in callback frameworks</em>ï¼Œæƒ³ä¸æ˜ç™½ï¼Œä¸€é¡¿ Google ä¾æ—§çœ‹ä¸ªä¼¼æ‡‚éæ‡‚ã€‚æˆ‘æƒ³æŠŠè¿™äº›å‡Œä¹±çš„çº¿ç´¢éƒ½æ•´ç†å‡ºæ¥ï¼ŒæŠ½æŠ½å‰ªå‰ªæ’åˆ—ç»„åˆä¸€ä¸‹ï¼Œä¹Ÿè®¸å°±çœ‹çš„é€å½»ç‚¹äº†å‘¢ã€‚</p>

<p>å…³äº <em>Wrapper class</em> çš„å¼•å‡ºé—®é¢˜ï¼Œä¸ªäººè®¤ä¸ºæ¯”è¾ƒ<a href="http://programmers.stackexchange.com/questions/117628/why-are-wrapper-classes-not-suited-for-use-in-callback-frameworks">ç‚«é…·çš„è§£ç­”</a>ã€‚</p>

<p><blockquote><p>Because a wrapped object doesn&rsquo;t know of its wrapper, it passes a reference to itself(this) and callbacks elude the wrapper. This is known as the SELF problem <a href="https://static.aminer.org/pdf/PDF/000/522/451/using_prototypical_objects_to_implement_shared_behavior_in_object_oriented.pdf">Lieberman86</a>. This leads to subtle bugs, like the wrapper missing the event. Or the wrapper and wrapped object both registering for the same events - leading to duplicate processing and potential concurrency issues as well. If you don&rsquo;t know (don&rsquo;t have the source code) where callbacks are registered, it may be impossible to work around this problem.</p></blockquote></p>

<h1>Panttern? Framework?</h1>

<p>å¼•å‡ºä¸­çš„ <em>Wrapper class</em> æ˜¯ <em>Decorator pattern</em> çš„å¼•å‡ºæ¦‚å¿µï¼Œ<em>callback frameworks</em> æ˜¯ä¸€ç§ <em>framework</em>ã€‚ä»ç¿»è¯‘ä¸Šçœ‹ï¼Œ<em>pattern</em> è¯‘ä¸º <strong>æ¨¡å¼</strong>ï¼Œ<em>framework</em> è¯‘ä¸º <strong>æ¡†æ¶</strong>ã€‚é‚£ä¹ˆè¿™ä¸ª <em>pattern</em> ä¸ <em>framework</em> æœ‰æ¯›çš„åŒºåˆ«å‘¢ï¼Ÿ</p>

<!--more-->


<p><a href="https://www.dre.vanderbilt.edu/~schmidt/PDF/patterns-intro4.pdf">Introduction to Patterns and Frameworks</a> å’Œ <a href="http://stackoverflow.com/questions/320142/design-patterns-vs-frameworks">Design patterns vs Frameworks</a> å¯¹è¿™ä¸ªé—®é¢˜éƒ½æœ‰æ¯”è¾ƒç³»ç»Ÿçš„åˆ†æï¼Œå„ä½çœ‹å®˜å¯ä»¥ç»†ç»†å“çœ‹ä¸€ä¸‹ã€‚ä¸€è¨€ä»¥è”½ä¹‹ï¼Œ<em>pattern</em> æ˜¯è§£å†³æŸä¸ªå…·ä½“é—®é¢˜çš„æ–¹æ¡ˆï¼Œ<em>framework</em> æ˜¯ä¸€å¥—ç³»ç»Ÿæ¶æ„å¯é‡ç”¨çš„ç»„ä»¶ï¼ˆé€šå¸¸åŒ…æ‹¬è‹¥å¹²ä¸ª <em>pattern</em>ï¼‰ï¼Œä»–ä»¬ç»å¸¸å…±åŒä¸ºè½¯ä»¶ç³»ç»Ÿçš„å¯é‡ç”¨æ€§ã€å¯æ‰©å±•æ€§æä¾›æ”¯æŒã€‚</p>

<p><blockquote><p>Patterns support reuse of software architecture and design: Patterns capture the static and dynamic structures and collaborations of successful solutions to problems that arise when building applications in a particular domain.<br/>Frameworks support reuse of detailed design and code: A framework is an integrated set of components that collaborate to provide a reusable architecture for a family of related applications.</p></blockquote></p>

<h1>Framework</h1>

<h2>Inversion of Control</h2>

<p>æ‰“ä¸ªæ¯”æ–¹ï¼š<em>Frameworks</em> å°±æ˜¯æŒ–å¥½äº†ä¸€å †å‘ï¼Œè®©ä½ å¾€é‡Œé¢å¡«èåœï¼Œå¡«è‚¥æ–™ã€‚ä¸åŒçš„è‚¥æ–™æ€ä¹ˆæ‰¾å¯¹åº”çš„èåœ <em>Frameworks</em> æ¥æ¥æ‰‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯<strong>æ§åˆ¶åè½¬</strong>ï¼ˆ<a href="https://en.wikipedia.org/wiki/Inversion_of_control">Inversion of Control</a>ï¼‰å•¦ã€‚</p>

<p><blockquote><p>Don&rsquo;t call us, we&rsquo;ll call you.</p><footer><strong>Hollywood principle</strong></footer></blockquote></p>

<h3>Dependency injection</h3>

<p>ä»ä»£ç ä¸Šçœ‹ï¼Œ<em>IoC</em> çš„å®ç°ä¸»è¦åŒ…æ‹¬<strong>ä¾èµ–æ³¨å…¥</strong>ï¼ˆ<a href="https://en.wikipedia.org/wiki/Dependency_injection">Dependency injection</a>ï¼‰ï¼Œä»¥åŠå…¶ä»–çš„ä¸€äº› <em>Patterns</em>ã€‚æ‰€ä»¥å‡†ç¡®çš„æ¥è¯´ï¼Œ<em>Dependency injection</em> æ˜¯å®ç° <em>IoC</em> çš„ä¸€ç§é€”å¾„ï¼Œä½†æ˜¯ç°åœ¨å¾ˆå¤šçš„æŠ€æœ¯é¸¡æ±¤æ–‡éƒ½æŠŠå®ƒä»¬åˆ’ä¸Šäº†ç­‰äºå·ï¼Œè¿™é‡Œäº†è§£ä¸€ä¸‹æ¦‚å¿µå³å¯ï¼Œæ— ä¼¤å¤§é›…ã€‚</p>

<p><em>So</em>ï¼Œ<em>Frameworks</em> çš„åŸºç¡€æ˜¯ <em>IoC</em>ï¼Œè€Œ <em>IoC</em> çš„åŸºç¡€åˆæ˜¯ <em>Dependency injection</em>ã€‚ä¸è¦è¢«è¿™ä¸ªé«˜å¤§ä¸Šçš„åè¯å”¬åˆ°ï¼Œå…¶å®å®ƒï¼ˆä¸»è¦ï¼‰å°±æ˜¯ <code>set</code> æ–¹æ³•è€Œå·²ã€‚</p>

<h2>Callback frameworks</h2>

<p>å¦‚æœè¯´ <em>IoC</em> çš„ç²¾é«“ä¸€å¥è¯æ¦‚æ‹¬ä¸ºï¼š<em>Don&rsquo;t call us, we&rsquo;ll call you.</em></p>

<p>é‚£ä¹ˆ<strong>å›è°ƒ</strong>ï¼ˆ<a href="http://www.codeweblog.com/%E6%B5%85%E6%9E%90java-callback-%E5%9B%9E%E8%B0%83%E6%A8%A1%E5%BC%8F/">callback</a>ï¼‰çš„ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼š<em>If you call me, i will call back.</em><sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></p>

<p><em>callback frameworks</em> å…¶å®å¹¶ä¸æ˜¯ä¸€ç§å…·ä½“çš„ <em>framework</em>ï¼Œè€Œæ˜¯ä»£è¡¨<strong>ä¸€ç±»</strong> <em>framework</em>ã€‚æ¯”å¦‚å¤§å¤šæ•°çš„ <em>GUI frameworks</em>ï¼Œæ¯”å¦‚ <em>SAX (Streaming XML) XML parsers</em>ã€‚</p>

<h3><a name="callback_code">Demo code</a></h3>

<pre><code class="java">public class Context implements A.Callback {

    private A a;

    public void begin() {
        System.out.println("begin ...");
    }

    public void end() {
        System.out.println("end ...");
    }

    public Context() {
        this.a = new A(this);
    }

    public void doSomething() {
        this.a.doIt();
    }

    public static void main(String args[]) {
        new Context().doSomething();
    }
}

public class A {

    private final Callback callback;

    public static interface Callback {
        public void begin();
        public void end();
    }
    public A(Callback callback) {
        this.callback = callback;
    }
    public void doIt() {
        callback.begin();
        System.out.println("do something ...");
        callback.end();
    }
}
</code></pre>

<h2>Spring</h2>

<p>å¦‚æœè¦æ‰¾ä¸€ç§å…·ä½“çš„ <em>framework</em>ï¼Œæœ€å…¸å‹çš„å½“ç„¶é <em>Spring</em> è«å±ã€‚</p>

<p>ç½‘ä¸Šä»‹ç»çš„æ–‡ç« ä¸€ç®©ç­ï¼Œæ¯”å¦‚è¿™ä¸¤ç¯‡ï¼Œ<a href="http://programmers.stackexchange.com/questions/92393/what-does-the-spring-framework-do-should-i-use-it-why-or-why-not?rq=1">æˆ³è¿™é‡Œ</a>ï¼Œ<a href="http://blog.csdn.net/taijianyu/article/details/2338311/">æˆ³è¿™é‡Œ</a>ã€‚å¯ä»¥ç®€å•çš„çœ‹ä¸€ä¸‹ï¼Œä¸»è¦æ˜¯åŠ æ·±å¯¹ <em>Dependency injection</em> çš„ç†è§£ã€‚</p>

<h1>Pattern</h1>

<h2>Decorator pattern</h2>

<p><blockquote><p>Favor composition over inheritance. Inheritance propagates any flaws in the superclassâ€™s API, while composition lets you design a new API that hides these flaws.</p></blockquote></p>

<p>è£…é¥°è€…æ¨¡å¼æ˜¯<em>ç»§æ‰¿å¯å®ä¾‹åŒ–çš„ç±»</em>çš„æ›¿ä»£è§£å†³æ–¹æ¡ˆï¼Œ<a href="https://books.google.com.hk/books?id=ka2VUBqHiWkC&amp;pg=PA85&amp;dq=The+disadvantage+of+wrapper+classes&amp;hl=en&amp;sa=X&amp;ved=0CB0Q6AEwAGoVChMI5L-T5PnPxgIVCQuOCh1joQq6#v=onepage&amp;q=The%20disadvantage%20of%20wrapper%20classes&amp;f=false">Effective Java, Item 16</a> ä¸€èŠ‚çš„ä¸»é¢˜æ­£æ˜¯ <em>Favor composition over inheritance</em>ã€‚B ç»§æ‰¿å¯å®ä¾‹åŒ–çš„ç±» A æœ‰å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚</p>

<ul>
<li>B ä¾èµ–äº A çš„å®ç°ç»†èŠ‚ï¼Œå¦‚æœ A çš„åç»­ç‰ˆæœ¬ä¸­æ›´æ–°äº†å®ç°ç»†èŠ‚ï¼Œå¯èƒ½ä¼šç ´å B</li>
<li>A åœ¨åç»­ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šåŠ å…¥æ–°çš„æ–¹æ³•ï¼Œä¸æ»¡è¶³ B çš„ check</li>
<li>A çš„åç»­ç‰ˆæœ¬ä¸­åŠ å…¥äº†æ–°æ–¹æ³• mï¼Œä¸å·§ B æå‰å£°æ˜äº† m</li>
<li>B ä¸å¯èƒ½å®ç°ä¸€ä¸ªæ»¡æ„çš„ <code>equals</code> æ–¹æ³•ï¼ˆ<a href="https://books.google.com.hk/books?id=ka2VUBqHiWkC&amp;pg=PA40&amp;dq=While+there+is+no+satisfactory+way+to+extend+an+instantiable+class+and+add+a+value+component&amp;hl=en&amp;sa=X&amp;ved=0CB0Q6AEwAGoVChMI08nF6OrVxgIVhe9yCh28bQWD#v=onepage&amp;q=While%20there%20is%20no%20satisfactory%20way%20to%20extend%20an%20instantiable%20class%20and%20add%20a%20value%20component&amp;f=false">Effective Java, Item 8</a>ï¼‰</li>
</ul>


<h3><a name="forward">Demo code</a></h3>

<pre><code class="java">// Wrapper class - uses composition in place of inheritance
public class InstrumentedSet&lt;E&gt; extends ForwardingSet&lt;E&gt; {
    private int addCount = 0;

    public InstrumentedSet(Set&lt;E&gt; s) {
        super(s);
    }

    @Override
    public boolean add(E e) {
        addCount++;
        return super.add(e);
    }

    @Override
    public boolean addAll(Collection&lt;? extends E&gt; c) {
        addCount += c.size();
        return super.addAll(c);
    }

    public int getAddCount() {
        return addCount;
    }
}

// Reusable forwarding class
public class ForwardingSet&lt;E&gt; implements Set&lt;E&gt; {
    private final Set&lt;E&gt; s;
    public ForwardingSet(Set&lt;E&gt; s)      { this.s = s;              }
    public void clear()                 { s.clear();               }
    public boolean contains(Object o)   { return s.contains(o);    }
    public boolean isEmpty()            { return s.isEmpty();      }
    public int size()                   { return s.size();         }
    public Iterator&lt;E&gt; iterator()       { return s.iterator();     }
    public boolean add(E e)             { return s.add(e);         }
    public boolean remove(Object o)     { return s.remove(o);      }
    public boolean containsAll(Collection&lt;?&gt; c) 
                                        { return s.containsAll(c); }
    public boolean addAll(Collection&lt;? extends E&gt; c)
                                        { return s.addAll(c);      }
    public boolean removeAll(Collection&lt;?&gt; c)
                                        { return s.removeAll(c);   }
    public boolean retainAll(Collection&lt;?&gt; c)
                                        { return s.retainAll(c);   }
    public Object[] toArray()           { return s.toArray();      }
    public &lt;T&gt; T[] toArray(T[] a)       { return s.toArray(a);     }
    @Override public boolean equals(Object o)
                                        { return s.equals(o);      }
    @Override public int hashCode()     { return s.hashCode();     }
    @Override public String toString()  { return s.toString();     }
}
</code></pre>

<h1>å†è°ˆå¼•å‡º</h1>

<p><em>Wrapper classes are not suited for use in callback frameworks</em>ï¼Œåœ¨äº†è§£äº†ç›¸å…³çš„å„ç§åŸºæœ¬æ¦‚å¿µåï¼Œç°åœ¨å¯ä»¥ç»™å‡ºç¤ºä¾‹ä»£ç äº†ã€‚ç»“åˆä¹‹å‰ä»‹ç»çš„ <a href="#callback_code">callback framework demo code</a> è¿›è¡Œè¯´æ˜ï¼Œç»™ <code>Context</code> ä¸€ä¸ª <em>Wrapper class</em>ï¼Œè§‚å¯Ÿæ•ˆæœã€‚</p>

<pre><code class="java">public class ContextB implements Callback {

    Callback real;

    public ContextB(Callback real) {
        this.real = real;
    }

    @Override
    public void begin() {
        System.out.println("B begin ...");
        real.begin();
    }

    @Override
    public void end() {
        System.out.println("B end ...");
        real.end();
    }

    public void ex() {
        System.out.println("B ex ...");
        real.ex();
    }

    public static void main(String args[]) {
        Callback real = new Context();
        new ContextB(real).ex();
    }
}
</code></pre>

<p>è§‚å¯Ÿè¾“å‡ºï¼Œæœ‰è±ç„¶å¼€æœ—çš„æ„Ÿè§‰å—ï¼Ÿæœ‰è¯·ç‚¹èµ~</p>

<pre><code class="java">B ex ...
begin ...
do something ...
end ...
</code></pre>

<h1>æ‰©å±•é˜…è¯»</h1>

<ul>
<li><a href="https://books.google.com.hk/books?id=ka2VUBqHiWkC&amp;pg=PA85&amp;dq=The+disadvantage+of+wrapper+classes&amp;hl=en&amp;sa=X&amp;ved=0CB0Q6AEwAGoVChMI5L-T5PnPxgIVCQuOCh1joQq6#v=onepage&amp;q=The%20disadvantage%20of%20wrapper%20classes&amp;f=false">Effective Java, Item 16</a></li>
<li><a href="https://books.google.com.hk/books?id=ka2VUBqHiWkC&amp;pg=PA40&amp;dq=While+there+is+no+satisfactory+way+to+extend+an+instantiable+class+and+add+a+value+component&amp;hl=en&amp;sa=X&amp;ved=0CB0Q6AEwAGoVChMI08nF6OrVxgIVhe9yCh28bQWD#v=onepage&amp;q=While%20there%20is%20no%20satisfactory%20way%20to%20extend%20an%20instantiable%20class%20and%20add%20a%20value%20component&amp;f=false">Effective Java, Item 8</a></li>
<li><a href="http://programmers.stackexchange.com/questions/117628/why-are-wrapper-classes-not-suited-for-use-in-callback-frameworks">Why are wrapper classes not suited for use in callback frameworks</a></li>
<li><a href="https://www.dre.vanderbilt.edu/~schmidt/PDF/patterns-intro4.pdf">Introduction to Patterns and Frameworks</a></li>
<li><a href="http://stackoverflow.com/questions/320142/design-patterns-vs-frameworks">Design patterns vs Frameworks</a></li>
<li><a href="http://www.codeweblog.com/%E6%B5%85%E6%9E%90java-callback-%E5%9B%9E%E8%B0%83%E6%A8%A1%E5%BC%8F/">æµ…æ Java Callback å›è°ƒæ¨¡å¼</a></li>
<li><a href="https://en.wikipedia.org/wiki/Inversion_of_control">Inversion of Control ç»´åŸºç™¾ç§‘</a></li>
<li><a href="https://en.wikipedia.org/wiki/Dependency_injection">Dependency injection ç»´åŸºç™¾ç§‘</a></li>
<li><a href="http://programmers.stackexchange.com/questions/92393/what-does-the-spring-framework-do-should-i-use-it-why-or-why-not?rq=1">What is dependency injection</a></li>
<li><a href="http://blog.csdn.net/taijianyu/article/details/2338311/">ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥</a></li>
<li><a href="https://static.aminer.org/pdf/PDF/000/522/451/using_prototypical_objects_to_implement_shared_behavior_in_object_oriented.pdf">Using Prototypical Objects to Implement Shared Behavior in Object Oriented Systems</a></li>
</ul>

<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>This is bullshit. è¯·çœ‹è´Ÿè´£ä»»é‚£ç¯‡<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

]]></content>
  </entry>
  
</feed>
